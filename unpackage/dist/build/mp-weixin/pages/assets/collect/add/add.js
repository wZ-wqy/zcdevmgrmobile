(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/assets/collect/add/add"],{9002:function(t,e,s){"use strict";(function(t){s("29fc");n(s("66fd"));var e=n(s("fc28"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])},"9e6a":function(t,e,s){"use strict";s.d(e,"b",(function(){return i})),s.d(e,"c",(function(){return o})),s.d(e,"a",(function(){return n}));var n={uToast:function(){return s.e("uview-ui/components/u-toast/u-toast").then(s.bind(null,"2261"))},uSelect:function(){return s.e("uview-ui/components/u-select/u-select").then(s.bind(null,"4b94"))},uCalendar:function(){return s.e("uview-ui/components/u-calendar/u-calendar").then(s.bind(null,"e96a"))},uForm:function(){return s.e("uview-ui/components/u-form/u-form").then(s.bind(null,"5241"))},uFormItem:function(){return Promise.all([s.e("common/vendor"),s.e("uview-ui/components/u-form-item/u-form-item")]).then(s.bind(null,"6658"))},uInput:function(){return Promise.all([s.e("common/vendor"),s.e("uview-ui/components/u-input/u-input")]).then(s.bind(null,"b093"))},uEmpty:function(){return s.e("uview-ui/components/u-empty/u-empty").then(s.bind(null,"dea5"))},uIcon:function(){return s.e("uview-ui/components/u-icon/u-icon").then(s.bind(null,"d696"))},uButton:function(){return s.e("uview-ui/components/u-button/u-button").then(s.bind(null,"2a9f"))}},i=function(){var t=this,e=t.$createElement;t._self._c},o=[]},a274:function(t,e,s){"use strict";s.r(e);var n=s("c1a3"),i=s.n(n);for(var o in n)"default"!==o&&function(t){s.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},c1a3:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(s("a34a"));i(s("b908"));function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e,s,n,i,o,u){try{var r=t[o](u),a=r.value}catch(c){return void s(c)}r.done?e(a):Promise.resolve(a).then(n,i)}function u(t){return function(){var e=this,s=arguments;return new Promise((function(n,i){var u=t.apply(e,s);function r(t){o(u,n,i,r,a,"next",t)}function a(t){o(u,n,i,r,a,"throw",t)}r(void 0)}))}}var r={data:function(){return{required:!0,show:!0,saveloading:!1,inputdisable:!0,maxyear:"2100",lyshow:!1,partshow:!1,usershow:!1,usedcompshow:!1,sdataList:[],dataList:[],usedcomplist:[],userlist:[],partlist:[],form:{bustype:"LY",name:"",busdate:"",cruserid:"",crusername:"",tusedcompanyid:"",tusedcompanyname:"",tpartid:"",tpartname:"",tuseduserid:"",tusedusername:"",tlocdtl:"",mark:"",items:""}}},onLoad:function(t){var e=this,s={parts:"Y",partusers:"Y",comp:"Y",uid:"mobile_data1",dicts:""};e.$u.post("/api/zc/queryDictFast.do",s).then((function(t){t.success&&(e.usedcomplist=t.data.comp,e.partlist=t.data.parts,e.userlist=t.data.partusers)}))},onUnload:function(e){t.$off("selectAssetsFun")},onShow:function(e){var s=this;t.$on("selectAssetsFun",(function(t){if(t.data.length>0){s.$refs.uToast.show({title:"已选择数量:"+t.data.length,position:"center",type:"success",icon:!0,url:""}),s.sdataList=t.data;for(var e=0;e<s.sdataList.length;e++){for(var n=!0,i=0;i<s.dataList.length;i++)if(s.dataList[i].id==s.sdataList[e].id){n=!1;break}n&&s.dataList.push(s.sdataList[e])}}}))},methods:{search:function(){this.sdataList=[],this.$u.route({url:"/pages/common/searchassets/searchassets",params:{datarange:"LY"}})},removeitem:function(t,e){this.dataList.splice(e,1)},save:function(){var e=this,s={};if(this.$u.test.isEmpty(this.form.name))this.$refs.uToast.show({title:"输入单据名称",position:"center",type:"error",icon:!0,url:""});else if(this.$u.test.isEmpty(this.form.cruserid))this.$refs.uToast.show({title:"选择领用人",position:"center",type:"error",icon:!0,url:""});else if(this.$u.test.isEmpty(this.form.busdate))this.$refs.uToast.show({title:"选择领用时间",position:"center",type:"error",icon:!0,url:""});else if(this.$u.test.isEmpty(this.form.tusedcompanyid))this.$refs.uToast.show({title:"选择使用公司",position:"center",type:"error",icon:!0,url:""});else if(this.$u.test.isEmpty(this.form.tpartid))this.$refs.uToast.show({title:"选择使用部门",position:"center",type:"error",icon:!0,url:""});else if(0!=this.dataList.length)if(this.dataList.length>10)this.$refs.uToast.show({title:"领用资产数量不可超过10",position:"center",type:"error",icon:!0,url:""});else{s=this.form,s.items=JSON.stringify(this.dataList),this.saveloading=!0;for(var n=[],i=0;i<this.dataList.length;i++)n.push(this.dataList[i].id);var o={type:"LY",items:JSON.stringify(n)};this.$u.post("/api/zc/fastProcessItemCheck.do",o).then((function(n){e.saveloading=!1,n.success?e.$u.post("/api/zc/resCollectionreturn/ext/insertOrUpdate.do",s).then((function(s){if(s.success){var n={ifsp:"0",ptype:"LY",title:"",busid:s.data.busid,formtype:"none"};e.$u.post("/api/zc/flow/startAssetFlow.do",n).then((function(s){s.success&&(e.$refs.uToast.show({title:"新增成功",type:"success",url:"/pages/user/index"}),t.navigateBack({delta:1,success:function(){getCurrentPages().pop()}}))}))}else e.$refs.uToast.show({title:s.message,position:"center",type:"error",icon:!0,url:""})})):e.$refs.uToast.show({title:n.message,position:"center",type:"error",icon:!0,url:""})}))}else this.$refs.uToast.show({title:"请选择资产",position:"center",type:"error",icon:!0,url:""})},partConfirm:function(t){this.form.tpartid=t[0].value,this.form.tpartname=t[0].label},userConfirm:function(t){this.form.cruserid=t[0].value,this.form.crusername=t[0].label,this.form.tuseduserid=t[0].value,this.form.tusedusername=t[0].label},usedcompConfirm:function(t){this.form.tusedcompanyid=t[0].value,this.form.tusedcompanyname=t[0].label},lychange:function(t){this.form.busdate=t.result},partSelect:function(){this.partshow=!0},userSelect:function(){this.usershow=!0},lydateSelect:function(){this.lyshow=!0},usedcompSelect:function(){this.usedcompshow=!0},scan:function(){var e=this;return u(n.default.mark((function s(){return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:t.scanCode({success:function(t){e.result=t.result,e.$u.get("/api/base/res/queryResAll.do",{uuid:e.result}).then((function(t){if(1==t.data.length){for(var s=!0,n=0;n<e.dataList.length;n++)if(e.dataList[n].id==t.data[0].id){s=!1;break}s&&e.dataList.push(t.data[0])}else e.$refs.uToast.show({title:"无资产数据",position:"center",type:"error",icon:!0,url:""})}))},fail:function(e){t.getSetting({success:function(e){var s=e.authSetting["scope.camera"];s||t.showModal({title:"授权失败",content:"需要使用您的相机，请在设置界面打开相关权限",success:function(e){e.confirm&&t.openSetting()}})}})}});case 1:case"end":return s.stop()}}),s)})))()}}};e.default=r}).call(this,s("543d")["default"])},fc28:function(t,e,s){"use strict";s.r(e);var n=s("9e6a"),i=s("a274");for(var o in i)"default"!==o&&function(t){s.d(e,t,(function(){return i[t]}))}(o);var u,r=s("f0c5"),a=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,"51cd9665",null,!1,n["a"],u);e["default"]=a.exports}},[["9002","common/runtime","common/vendor"]]]);